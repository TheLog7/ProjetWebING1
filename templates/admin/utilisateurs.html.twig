{% extends 'base.html.twig' %}

{% block title %}Liste des Utilisateurs{% endblock %}

{% block body %}
<div class="container mx-auto p-6">
    <h1 class="text-3xl font-bold text-gray-800 mb-6">Liste des Utilisateurs</h1>
    
    <div class="mb-4">
        <a href="{{ path('app_register') }}" class="bg-blue-500 text-blue px-4 py-2 rounded-lg">Ajouter un utilisateur</a>
    </div>

    {% set non_verifies = [] %}
    {% set verifies = [] %}
    {% set rejetes = [] %}

    {% for utilisateur in utilisateurs %}
        {% if utilisateur.valide == 'En attente de validation' %}
            {% set non_verifies = non_verifies|merge([utilisateur]) %}
        {% elseif utilisateur.valide == 'Validé' %}
            {% set verifies = verifies|merge([utilisateur]) %}
        {% elseif utilisateur.valide == 'Refusé' %}
            {% set rejetes = rejetes|merge([utilisateur]) %}
        {% endif %}
    {% endfor %}

    <!-- Utilisateurs non vérifiés -->
    <h2 class="text-2xl font-semibold text-red-600 mt-8 mb-4">Utilisateurs en attente de vérification</h2>
    <table class="w-full bg-white shadow-md rounded-lg">
        <thead>
            <tr class="bg-gray-200">
                <th class="p-3 text-left">Photo</th>
                <th class="p-3 text-left">ID</th>
                <th class="p-3 text-left">Nom</th>
                <th class="p-3 text-left">Prénom</th>
                <th class="p-3 text-left">Email</th>
                <th class="p-3 text-left">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for utilisateur in non_verifies %}
                <tr class="border-b">
                    <td class="p-3">
                        {% if utilisateur.photo %}
                            <img src="{{ asset(utilisateur.photo) }}" alt="Photo de {{ utilisateur.nom }}" class="w-12 h-12 rounded-full object-cover">
                        {% else %}
                            <span class="text-gray-500">Aucune photo</span>
                        {% endif %}
                    </td>
                    <td class="p-3">{{ utilisateur.id }}</td>
                    <td class="p-3">{{ utilisateur.nom }}</td>
                    <td class="p-3">{{ utilisateur.prenom }}</td>
                    <td class="p-3">{{ utilisateur.email }}</td>
                    <td class="p-3">
                        <a href="{{ path('admin_utilisateur_modifier', {'id': utilisateur.id}) }}" class="text-yellow-500">Modifier</a> |
                        <form action="{{ path('admin_utilisateur_supprimer', {'id': utilisateur.id}) }}" method="post" class="inline">
                            <input type="hidden" name="_token" value="{{ csrf_token('supprimer_utilisateur_' ~ utilisateur.id) }}">
                            <button type="submit" class="text-red-500" onclick="return confirm('Êtes-vous sûr de vouloir supprimer cet utilisateur ?');">
                                Supprimer
                            </button>
                        </form>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="6" class="p-3 text-center text-gray-500">Tous les utilisateurs ont été vérifiés.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Utilisateurs vérifiés -->
    <h2 class="text-2xl font-semibold text-green-600 mt-12 mb-4">Utilisateurs vérifiés</h2>
    <table class="w-full bg-white shadow-md rounded-lg">
        <thead>
            <tr class="bg-gray-200">
                <th class="p-3 text-left">Photo</th>
                <th class="p-3 text-left">ID</th>
                <th class="p-3 text-left">Nom</th>
                <th class="p-3 text-left">Prénom</th>
                <th class="p-3 text-left">Email</th>
                <th class="p-3 text-left">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for utilisateur in verifies %}
                <tr class="border-b">
                    <td class="p-3">
                        {% if utilisateur.photo %}
                            <img src="{{ asset(utilisateur.photo) }}" alt="Photo de {{ utilisateur.nom }}" class="w-12 h-12 rounded-full object-cover">
                        {% else %}
                            <span class="text-gray-500">Aucune photo</span>
                        {% endif %}
                    </td>
                    <td class="p-3">{{ utilisateur.id }}</td>
                    <td class="p-3">{{ utilisateur.nom }}</td>
                    <td class="p-3">{{ utilisateur.prenom }}</td>
                    <td class="p-3">{{ utilisateur.email }}</td>
                    <td class="p-3">
                        <a href="{{ path('admin_utilisateur_modifier', {'id': utilisateur.id}) }}" class="text-yellow-500">Modifier</a> |
                        <form action="{{ path('admin_utilisateur_supprimer', {'id': utilisateur.id}) }}" method="post" class="inline">
                            <input type="hidden" name="_token" value="{{ csrf_token('supprimer_utilisateur_' ~ utilisateur.id) }}">
                            <button type="submit" class="text-red-500" onclick="return confirm('Êtes-vous sûr de vouloir supprimer cet utilisateur ?');">
                                Supprimer
                            </button>
                        </form>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="6" class="p-3 text-center text-gray-500">Aucun utilisateur vérifié trouvé.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Utilisateurs rejetés -->
    <h2 class="text-2xl font-semibold text-gray-600 mt-12 mb-4">Utilisateurs rejetés</h2>
    <table class="w-full bg-white shadow-md rounded-lg">
        <thead>
            <tr class="bg-gray-200">
                <th class="p-3 text-left">ID</th>
                <th class="p-3 text-left">Nom</th>
                <th class="p-3 text-left">Prénom</th>
                <th class="p-3 text-left">Email</th>
            </tr>
        </thead>
        <tbody>
            {% for utilisateur in rejetes %}
                <tr class="border-b">
                    <td class="p-3">{{ utilisateur.id }}</td>
                    <td class="p-3">{{ utilisateur.nom }}</td>
                    <td class="p-3">{{ utilisateur.prenom }}</td>
                    <td class="p-3">{{ utilisateur.email }}</td>
                    <td class="p-3">
                        <a href="{{ path('admin_utilisateur_modifier', {'id': utilisateur.id}) }}" class="text-yellow-500">Modifier</a> |
                        <form action="{{ path('admin_utilisateur_supprimer', {'id': utilisateur.id}) }}" method="post" class="inline">
                            <input type="hidden" name="_token" value="{{ csrf_token('supprimer_utilisateur_' ~ utilisateur.id) }}">
                            <button type="submit" class="text-red-500" onclick="return confirm('Êtes-vous sûr de vouloir supprimer cet utilisateur ?');">
                                Supprimer
                            </button>
                        </form>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="4" class="p-3 text-center text-gray-500">Aucun utilisateur rejeté trouvé.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
